<%- include('partials/head', { title: 'ArtaPack | فراموشی رمز' }) %>

    <main class="flex-1 flex items-center justify-center px-4 sm:px-6 py-6 sm:py-10">
        <div class="w-full max-w-md mx-auto" style="animation: fadeUp .5s ease both;">

            <!-- لوگو -->
            <div class="text-center mb-6 sm:mb-8">
                <div class="w-[88px] h-[88px] mx-auto mb-4 rounded-full overflow-hidden
                    ring-[3px] ring-brand-200 shadow-lg shadow-brand-500/15">
                    <img src="/images/generated-image.png" alt="لوگوی آرتاپک" class="w-full h-full object-cover">
                </div>
                <h2 class="text-[20px] font-extrabold text-gray-800" id="pageTitle">فراموشی رمز عبور</h2>
                <p class="text-[12px] text-gray-400 mt-1.5" id="pageSubtitle">شماره تلفن خود را وارد کنید</p>
            </div>

            <!-- پیام خطا/موفقیت -->
            <div id="alertBox" class="hidden mb-5 rounded-xl px-4 py-3 flex items-center gap-2.5"></div>

            <!-- ═══════ مرحله ۱: ارسال شماره ═══════ -->
            <form id="phoneForm" class="space-y-5">
                <div>
                    <label for="phone" class="block text-[12px] font-bold text-gray-600 mb-2 mr-1">شماره تلفن</label>
                    <div class="relative">
                        <span class="absolute right-3.5 top-1/2 -translate-y-1/2 text-gray-300 pointer-events-none">
                            <svg class="w-[18px] h-[18px]" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6
                                     19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72
                                     12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27
                                     a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z" />
                            </svg>
                        </span>
                        <input type="tel" id="phone" name="phone" required autocomplete="tel"
                            placeholder="مثلاً: 09134466889" dir="ltr" style="text-align: right;" class="w-full pr-11 pl-4 py-3.5 bg-cream-50 border-2 border-gray-100
                               rounded-xl text-[13px] text-gray-700 placeholder-gray-300
                               outline-none font-medium transition-all duration-300
                               focus:border-brand-500 focus:shadow-[0_0_0_3px_rgba(249,115,22,.15)]">
                    </div>
                </div>

                <button type="submit" id="sendCodeBtn" class="w-full py-3.5 rounded-xl text-white font-extrabold text-[15px]
                       flex items-center justify-center gap-2 transition-all duration-300
                       bg-gradient-to-l from-brand-400 via-brand-500 to-brand-600
                       hover:from-brand-500 hover:via-brand-600 hover:to-brand-700
                       hover:-translate-y-0.5 hover:shadow-lg hover:shadow-brand-500/35
                       active:translate-y-0">
                    <span id="sendCodeText">ارسال کد تأیید</span>
                    <svg id="sendCodeSpinner" class="w-5 h-5 animate-spin hidden" viewBox="0 0 24 24" fill="none">
                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3" opacity=".25" />
                        <path d="M12 2a10 10 0 0 1 10 10" stroke="currentColor" stroke-width="3"
                            stroke-linecap="round" />
                    </svg>
                </button>
            </form>

            <!-- ═══════ مرحله ۲: وارد کردن کد ═══════ -->
            <form id="codeForm" class="space-y-5 hidden">
                <!-- اینپوت‌های کد ۴ رقمی -->
                <div>
                    <label class="block text-[12px] font-bold text-gray-600 mb-3 mr-1">کد تأیید را وارد کنید</label>
                    <div class="flex justify-center gap-3" dir="ltr" id="codeInputs">
                        <input type="text" maxlength="1" inputmode="numeric" pattern="[0-9]" required class="code-input w-14 h-14 text-center text-[22px] font-black text-gray-800
                               bg-cream-50 border-2 border-gray-100 rounded-xl outline-none
                               transition-all duration-300
                               focus:border-brand-500 focus:shadow-[0_0_0_3px_rgba(249,115,22,.15)]" data-index="0">
                        <input type="text" maxlength="1" inputmode="numeric" pattern="[0-9]" required class="code-input w-14 h-14 text-center text-[22px] font-black text-gray-800
                               bg-cream-50 border-2 border-gray-100 rounded-xl outline-none
                               transition-all duration-300
                               focus:border-brand-500 focus:shadow-[0_0_0_3px_rgba(249,115,22,.15)]" data-index="1">
                        <input type="text" maxlength="1" inputmode="numeric" pattern="[0-9]" required class="code-input w-14 h-14 text-center text-[22px] font-black text-gray-800
                               bg-cream-50 border-2 border-gray-100 rounded-xl outline-none
                               transition-all duration-300
                               focus:border-brand-500 focus:shadow-[0_0_0_3px_rgba(249,115,22,.15)]" data-index="2">
                        <input type="text" maxlength="1" inputmode="numeric" pattern="[0-9]" required class="code-input w-14 h-14 text-center text-[22px] font-black text-gray-800
                               bg-cream-50 border-2 border-gray-100 rounded-xl outline-none
                               transition-all duration-300
                               focus:border-brand-500 focus:shadow-[0_0_0_3px_rgba(249,115,22,.15)]" data-index="3">
                    </div>
                </div>

                <!-- تایمر + ارسال مجدد -->
                <div class="text-center">
                    <p id="timerText" class="text-[12px] text-gray-400 font-medium">
                        ارسال مجدد تا <span id="timerCount" class="text-brand-500 font-bold">60</span> ثانیه
                    </p>
                    <button type="button" id="resendBtn" onclick="resendCode()"
                        class="hidden text-[12px] text-brand-500 hover:text-brand-700 font-bold transition-colors mt-1">
                        ارسال مجدد کد
                    </button>
                </div>

                <button type="submit" id="verifyBtn" class="w-full py-3.5 rounded-xl text-white font-extrabold text-[15px]
                       flex items-center justify-center gap-2 transition-all duration-300
                       bg-gradient-to-l from-brand-400 via-brand-500 to-brand-600
                       hover:from-brand-500 hover:via-brand-600 hover:to-brand-700
                       hover:-translate-y-0.5 hover:shadow-lg hover:shadow-brand-500/35
                       active:translate-y-0">
                    <span id="verifyText">تأیید کد</span>
                    <svg id="verifySpinner" class="w-5 h-5 animate-spin hidden" viewBox="0 0 24 24" fill="none">
                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3" opacity=".25" />
                        <path d="M12 2a10 10 0 0 1 10 10" stroke="currentColor" stroke-width="3"
                            stroke-linecap="round" />
                    </svg>
                </button>
            </form>

            <!-- ═══════ مرحله ۳: رمز جدید ═══════ -->
            <form id="resetForm" class="space-y-5 hidden">
                <!-- رمز جدید -->
                <div>
                    <label class="block text-[12px] font-bold text-gray-600 mb-2 mr-1">رمز عبور جدید</label>
                    <div class="relative">
                        <span class="absolute right-3.5 top-1/2 -translate-y-1/2 text-gray-300 pointer-events-none">
                            <svg class="w-[18px] h-[18px]" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
                                <path d="M7 11V7a5 5 0 0 1 10 0v4" />
                            </svg>
                        </span>
                        <input type="password" id="resetNewPassword" required placeholder="رمز جدید را وارد کنید" class="w-full pr-11 pl-11 py-3.5 bg-cream-50 border-2 border-gray-100
                               rounded-xl text-[13px] text-gray-700 placeholder-gray-300
                               outline-none font-medium transition-all duration-300
                               focus:border-brand-500 focus:shadow-[0_0_0_3px_rgba(249,115,22,.15)]">
                        <button type="button" onclick="togglePass('resetNewPassword', this)"
                            class="absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-300 hover:text-brand-500 transition-colors">
                            <svg class="eye-off w-[18px] h-[18px]" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                                <path
                                    d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94" />
                                <path d="M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19" />
                                <path d="M14.12 14.12a3 3 0 1 1-4.24-4.24" />
                                <line x1="1" y1="1" x2="23" y2="23" />
                            </svg>
                            <svg class="eye-on w-[18px] h-[18px] hidden" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                                <circle cx="12" cy="12" r="3" />
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- تکرار رمز -->
                <div>
                    <label class="block text-[12px] font-bold text-gray-600 mb-2 mr-1">تکرار رمز جدید</label>
                    <div class="relative">
                        <span class="absolute right-3.5 top-1/2 -translate-y-1/2 text-gray-300 pointer-events-none">
                            <svg class="w-[18px] h-[18px]" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="20 6 9 17 4 12" />
                            </svg>
                        </span>
                        <input type="password" id="resetConfirmPassword" required
                            placeholder="رمز جدید را دوباره وارد کنید" class="w-full pr-11 pl-11 py-3.5 bg-cream-50 border-2 border-gray-100
                               rounded-xl text-[13px] text-gray-700 placeholder-gray-300
                               outline-none font-medium transition-all duration-300
                               focus:border-brand-500 focus:shadow-[0_0_0_3px_rgba(249,115,22,.15)]">
                        <button type="button" onclick="togglePass('resetConfirmPassword', this)"
                            class="absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-300 hover:text-brand-500 transition-colors">
                            <svg class="eye-off w-[18px] h-[18px]" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                                <path
                                    d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94" />
                                <path d="M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19" />
                                <path d="M14.12 14.12a3 3 0 1 1-4.24-4.24" />
                                <line x1="1" y1="1" x2="23" y2="23" />
                            </svg>
                            <svg class="eye-on w-[18px] h-[18px] hidden" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                                <circle cx="12" cy="12" r="3" />
                            </svg>
                        </button>
                    </div>
                </div>

                <button type="submit" id="resetBtn" class="w-full py-3.5 rounded-xl text-white font-extrabold text-[15px]
                       flex items-center justify-center gap-2 transition-all duration-300
                       bg-gradient-to-l from-green-400 via-green-500 to-green-600
                       hover:from-green-500 hover:via-green-600 hover:to-green-700
                       hover:-translate-y-0.5 hover:shadow-lg hover:shadow-green-500/35
                       active:translate-y-0">
                    <span id="resetText">ثبت رمز جدید</span>
                    <svg id="resetSpinner" class="w-5 h-5 animate-spin hidden" viewBox="0 0 24 24" fill="none">
                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3" opacity=".25" />
                        <path d="M12 2a10 10 0 0 1 10 10" stroke="currentColor" stroke-width="3"
                            stroke-linecap="round" />
                    </svg>
                </button>
            </form>

            <!-- بازگشت -->
            <div class="text-center mt-8">
                <a href="/login"
                    class="inline-flex items-center gap-1.5 text-[12px] text-gray-400 hover:text-brand-500 font-medium transition-colors group">
                    <svg class="w-4 h-4 transition-transform group-hover:translate-x-0.5" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <line x1="19" y1="12" x2="5" y2="12" />
                        <polyline points="12 19 5 12 12 5" />
                    </svg>
                    بازگشت به ورود
                </a>
            </div>

        </div>
    </main>

    </div><!-- /app shell -->

    <script src="/js/forgot-password.js"></script>
    </body>

    </html>